<script>
	$(function() {
		
		$('#back').on('click', function() {
			
			history.back();
		});
		
		$('input').on('input', function() {
			
			// 입력할 때마다 리스트 최신화
		});
		
		$(document).on('click', '.follow', function() {
			
			const btn = $(this);
			const targetId = btn.parent().parent().attr('id');

			
			$.ajax({
		      url: "/user/rest/addFollow",
		      method: "POST",
		      contentType:"application/json",
		      data: JSON.stringify({
		        targetId: targetId
		      }),
		      success: function(response) {
		        
		    	  console.log(response);
		    	  
				if(response == true || response == "true") {
					
					
					// btn.parent().find("button").text("언팔로우");
					// btn.parent().find("button").attr('class', 'unfollow');
					btn.text('언팔로우');
					btn.removeClass('follow').addClass('unfollow');
					
				} else {
					
					console.log('false');
					alert('변경 실패...');
					
				}
		      },
		      error: function(xhr, status, error) {
		        console.error("네트워크 오류:", error);
		        alert("네트워크 오류");
		      }
		    });
		});
		
		$(document).on('click', '.unfollow', function() {
			

			const btn = $(this);
			const targetId = btn.parent().parent().attr('id');

			$.ajax({
		      url: "/user/rest/deleteFollow",
		      method: "POST",
		      contentType:"application/json",
		      data: JSON.stringify({
		        targetId: targetId
		      }),
		      success: function(response) {
		        
		    	  console.log(response);
		    	  
				if(response == true || response == "true") {

					//btn.parent().find("button").text("팔로우");
					//btn.parent().find("button").attr('class', 'follow');
					btn.text('팔로우');
					btn.removeClass('unfollow').addClass('follow');
					
				} else {
					
					console.log('false');
					alert('변경 실패...');
					
				}
		      },
		      error: function(xhr, status, error) {
		        console.error("네트워크 오류:", error);
		        alert("네트워크 오류");
		      }
		    });
			
		});
		
		$(document).on('click', '.userDiv', function() {
			
			window.location.href="/user/getProfile?userId="+$(this).attr('id');
		});
	});
</script>

<!-- 검색은 선택 사항. -->
<!-- 
<form>
	<input type="text" name="search" />
</form>
 -->

<!-- 무한 스크롤 구현 필요 -->
<div th:each="user : ${list}">
	<div th:id="${user.userId}" class="d-flex">
			<div class="profile-box-custom mx-2 userDiv">
				<img class="profile-custom" th:src="@{/user/rest/profile/{uuid}(uuid=${user.profileImageName})}">
			</div>
			<div >
				<div class="d-flex mt-2 userDiv">
					<p th:text="${user.nickname}" class="me-2"></p>
					<p th:text="${user.isSubscribed == 1} ? '☑️'"></p> 
				</div>
				
				<button th:if="${sessionId != user.userId}" type="button" th:text="${user.isFollow == 1} ? '언팔로우' : '팔로우'" th:classappend="${user.isFollow == 1} ? 'unfollow' : 'follow'" class="btn btn-primary"></button>
				<p style="display:none;" th:text="${user.hideProfile}"></p>
			</div>
	</div>
	<hr/>
</div>

