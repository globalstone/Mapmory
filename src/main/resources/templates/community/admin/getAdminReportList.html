<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<title>전체신고목록</title>
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<link rel="stylesheet" href="/css/common/footer.css"> 
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>	
	<link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootswatch@5.2.3/dist/cosmo/bootstrap.min.css">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">	
	
	<!-- 신고처리 화면 이동 -->
	<script th:inline="javascript">
    $(document).ready(function() {
        $('.table-light').on('click', function () {
            var $row = $(this).closest('tr');
            var reportNo = $row.data('report-no');
            var reportStatus = $row.find('td:nth-child(2)').text().trim(); // 진행상황 열에서 텍스트 가져오기
            
            if (reportStatus === '처리완료') {
                // 이미 처리된 신고인 경우, 클릭 이벤트를 막음
                return false;
            }
            
            // 아직 처리되지 않은 신고인 경우, 페이지 이동 처리
            window.location.href = '/community/admin/getAdminConfirmReport/' + reportNo;
        });
    });
	</script>
	
	<style>
		th, td {
			text-align : center;
		}
		
		.unConfirmCount {
			font-weight: bold;
		}
	
		.reportCount {
			font-weight: bold;
		}	
	
		#navi {
		    width: 100%; 
		    text-align: center; 
		}
		
		.bi-card-list {
			margin-right : 5px;
		}
		
		.header {
			font-size : 16px;
			font-weight : bold;
		}
	</style>
	
</head>
<body>
	<div th:replace="common/toolBar::defaultToolBar"></div>
	<div class="container">
		<div>
		<ul class="nav nav-pills flex-column">
			<li class="nav-item">
				<a class="nav-link active">
		    		<i class="bi bi-card-list"></i>
		    		<span class="header">사용자 신고 목록 조회</span> 
	                <span class="unConfirmCount" th:text="'미처리된 신고 : '+${unConfirmCount}+'건'" style="float: right; margin-left: 10px;"></span>			    		
    		        <span class="reportCount" th:text="'전체 신고 : '+${totalCount}+'건'" style="float: right;"></span>
		    	</a>
			</li>
		</ul>		
		</div>

        <form id="reportForm" th:action="@{/community/admin/getAdminReportList}" method="post">
            <input type="hidden" id="currentPage" name="currentPage" th:value="${resultPage.currentPage}" />
        </form>		
		
		<table id="reportTable" class="table table-hover">
			<thead>
				<tr class="table-active">
					<th scope="col">신고제목</th>
					<th scope="col">진행상황</th>
					<th scope="col">처리결과</th>
					<th scope="col">신고일</th>
				</tr>
			</thead>
			<tbody>
				<tr class="table-light" th:each="report, rowStat : ${allReportList}" th:data-report-no="${report.reportNo}">
					<td class="reportTitle" th:text="${report.reportTitle}"></td>
					<td>
						<span th:switch="${report.reportStatus}">
							<span th:case="'1'">신고접수됨</span>
							<span th:case="'2'">처리완료</span>	
						</span>
					</td>
					<td>
						<span th:switch="${report.reportResult}">
							<span th:case="'0'">신고 처리 필요</span>
							<span th:case="'1'">승인</span>
							<span th:case="'2'">반려</span>
						</span>
					</td>
					<td th:text="${report.reportDate}"></td>
				</tr>
			</tbody>
		</table>
		<button type="button" id="unConfirm" class="btn btn-outline-dark">미처리 신고</button>	
	</div>
	<div class="pagination" th:replace="~{common/pageNavigator :: nav(${resultPage}, '/community/getAdminReportList')}"></div>	
</body>	
</html>